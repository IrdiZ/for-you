<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Save Obi ğŸˆâ€â¬›ğŸ’•</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;600&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  min-height: 100vh;
  background: linear-gradient(135deg, #0a0015 0%, #1a0030 30%, #2d1b4e 60%, #1a0030 100%);
  font-family: 'Poppins', sans-serif;
  overflow-x: hidden; color: #fff;
}

.bg-hearts {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none; z-index: 0; overflow: hidden;
}
.bg-heart {
  position: absolute; font-size: 20px; opacity: 0.12;
  animation: floatUp linear infinite;
}
@keyframes floatUp {
  0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
  10% { opacity: 0.12; } 90% { opacity: 0.12; }
  100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
}

.screen {
  display: none; flex-direction: column; align-items: center;
  justify-content: center; min-height: 100vh; padding: 20px;
  position: relative; z-index: 1;
}
.screen.active { display: flex; }

/* Typewriter & Story */
.story-container { max-width: 520px; width: 100%; text-align: center; }
.story-scene {
  font-size: 80px; margin-bottom: 20px;
  filter: drop-shadow(0 0 25px rgba(200,150,255,0.4));
  transition: all 0.3s;
}
.story-text {
  font-family: 'Crimson Text', serif; font-size: 1.25em;
  line-height: 1.9; opacity: 0.9; min-height: 100px;
  background: rgba(255,255,255,0.04); backdrop-filter: blur(15px);
  border: 1px solid rgba(255,100,150,0.15); border-radius: 20px;
  padding: 25px 30px; text-align: left; position: relative;
  cursor: pointer;
}
.story-text .cursor {
  display: inline-block; width: 2px; height: 1.2em;
  background: #ff6b9d; margin-left: 2px;
  animation: blink 0.8s step-end infinite; vertical-align: text-bottom;
}
@keyframes blink { 50% { opacity: 0; } }
.story-narrator {
  font-family: 'Dancing Script', cursive; font-size: 1em;
  color: #c4a0ff; margin-bottom: 8px; text-align: left; padding-left: 5px;
}
.chapter-title {
  font-family: 'Dancing Script', cursive; font-size: 2em;
  color: #ff6b9d; margin-bottom: 5px; animation: fadeInUp 1s ease;
}
.chapter-sub {
  font-size: 0.85em; opacity: 0.4; margin-bottom: 20px;
  animation: fadeInUp 1s ease 0.2s both;
}
@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

.continue-btn {
  margin-top: 25px; padding: 14px 40px; border: none; border-radius: 50px;
  font-family: 'Poppins', sans-serif; font-size: 1em; font-weight: 600;
  cursor: pointer; transition: all 0.3s;
  background: linear-gradient(135deg, #ff6b9d, #c44dff); color: white;
  box-shadow: 0 5px 25px rgba(255,107,157,0.4);
  opacity: 0; transform: translateY(10px); pointer-events: none;
}
.continue-btn.visible { opacity: 1; transform: translateY(0); pointer-events: all; transition: all 0.5s ease; }
.continue-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 35px rgba(255,107,157,0.6); }

.chapter-dots { display: flex; gap: 8px; justify-content: center; margin: 20px 0; }
.ch-dot {
  width: 10px; height: 10px; border-radius: 50%;
  background: rgba(255,255,255,0.15); transition: all 0.5s;
}
.ch-dot.active { background: #ff6b9d; box-shadow: 0 0 10px rgba(255,107,157,0.5); }
.ch-dot.done { background: #4ade80; }

/* Game shared */
.game-header { margin-bottom: 10px; text-align: center; }
.game-header h2 { font-family: 'Dancing Script', cursive; font-size: 1.8em; color: #ff6b9d; }
.game-stats {
  display: flex; gap: 20px; justify-content: center; margin: 10px 0; font-size: 1em;
}
.game-stats span { background: rgba(255,255,255,0.1); padding: 6px 16px; border-radius: 20px; }

/* ===== GAME 1: Memory ===== */
.game-board {
  display: grid; grid-template-columns: repeat(4,1fr); gap: 8px;
  max-width: 360px; margin: 0 auto; padding: 5px;
}
.card {
  aspect-ratio: 1; background: linear-gradient(135deg,#2d1b4e,#4a2d6e);
  border: 2px solid rgba(255,100,150,0.3); border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.8em; cursor: pointer; transition: all 0.4s;
  user-select: none; -webkit-tap-highlight-color: transparent;
}
.card:hover { border-color: rgba(255,100,150,0.6); }
.card.flipped { background: linear-gradient(135deg,#ff6b9d,#c44dff); transform: rotateY(180deg); border-color: #ff6b9d; }
.card.matched { background: linear-gradient(135deg,#4ade80,#22d3ee); border-color: #4ade80; animation: pop 0.5s ease; }
@keyframes pop { 50% { transform: scale(1.12); } }
.card .card-back { display: block; } .card .card-front { display: none; }
.card.flipped .card-back, .card.matched .card-back { display: none; }
.card.flipped .card-front, .card.matched .card-front { display: block; }

/* ===== GAME 2: Flower Garden ===== */
.garden-container { text-align: center; width: 100%; max-width: 400px; }
.garden-bouquet {
  display: flex; justify-content: center; gap: 5px; margin-bottom: 10px;
  min-height: 50px; flex-wrap: wrap;
}
.bouquet-flower {
  font-size: 28px; animation: bouquetPop 0.4s ease;
}
@keyframes bouquetPop { 0% { transform: scale(0) rotate(-180deg); } 100% { transform: scale(1) rotate(0deg); } }
.garden-progress {
  font-size: 0.95em; margin-bottom: 12px; opacity: 0.7;
}
.garden {
  display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px;
  max-width: 380px; margin: 0 auto;
}
.garden-spot {
  aspect-ratio: 1; border-radius: 50%;
  background: radial-gradient(circle, rgba(74,40,100,0.6) 0%, rgba(30,15,50,0.3) 70%);
  border: 2px solid rgba(100,200,100,0.15);
  display: flex; align-items: center; justify-content: center;
  font-size: 2.2em; cursor: pointer; transition: all 0.3s;
  user-select: none; -webkit-tap-highlight-color: transparent;
  position: relative; overflow: hidden;
}
.garden-spot::before {
  content: ''; position: absolute; width: 100%; height: 100%;
  background: radial-gradient(circle, rgba(255,200,100,0.15), transparent 70%);
  opacity: 0; transition: opacity 0.3s;
}
.garden-spot:hover::before { opacity: 1; }
.garden-spot.empty {
  opacity: 0.3; font-size: 1em; cursor: default;
}
.garden-spot.blooming {
  animation: bloom 0.5s ease; border-color: rgba(255,150,200,0.4);
}
@keyframes bloom {
  0% { transform: scale(0.3) rotate(-90deg); opacity: 0; }
  60% { transform: scale(1.2) rotate(10deg); }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}
.garden-spot.picked {
  animation: pickFlower 0.4s ease forwards;
}
@keyframes pickFlower {
  0% { transform: scale(1); }
  50% { transform: scale(1.3) translateY(-15px); }
  100% { transform: scale(0); opacity: 0; }
}
.garden-spot .sparkle-burst {
  position: absolute; font-size: 14px; animation: burstOut 0.6s ease forwards;
  pointer-events: none;
}
@keyframes burstOut {
  0% { transform: translate(0,0) scale(1); opacity: 1; }
  100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
}

/* ===== GAME 3: Quiz ===== */
.quiz-box {
  max-width: 440px; width: 100%; background: rgba(255,255,255,0.05);
  backdrop-filter: blur(20px); border: 1px solid rgba(255,100,150,0.2);
  border-radius: 20px; padding: 25px 22px;
}
.quiz-question {
  margin-bottom: 20px; line-height: 1.6;
  font-family: 'Dancing Script', cursive; font-size: 1.5em;
}
.quiz-options { display: flex; flex-direction: column; gap: 10px; }
.quiz-opt {
  padding: 14px 18px; border: 2px solid rgba(255,100,150,0.3);
  border-radius: 15px; background: rgba(255,255,255,0.05);
  cursor: pointer; transition: all 0.3s; font-family: 'Poppins', sans-serif;
  font-size: 0.95em; color: #fff; text-align: left;
}
.quiz-opt:hover { border-color: #ff6b9d; background: rgba(255,100,150,0.1); }
.quiz-opt.correct { border-color: #4ade80; background: rgba(74,222,128,0.2); }
.quiz-opt.wrong { border-color: #f87171; background: rgba(248,113,113,0.2); }
.quiz-progress { margin-top: 15px; opacity: 0.5; font-size: 0.9em; }

/* ===== Win ===== */
#win { text-align: center; }
.win-content { animation: fadeInUp 1s ease; max-width: 420px; }
.win-scene { font-size: 100px; margin-bottom: 10px; }
.win-obi { display: inline-block; animation: obiJump 1s ease-in-out infinite; }
@keyframes obiJump {
  0%,100% { transform: translateY(0) rotate(-3deg); }
  50% { transform: translateY(-25px) rotate(3deg); }
}
.win-text {
  font-family: 'Dancing Script', cursive; font-size: 2.8em; margin: 15px 0;
  background: linear-gradient(90deg,#ff6b9d,#ffd700,#ff6b9d);
  background-size: 200%; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  animation: shimmer 2s ease-in-out infinite;
}
.win-sub { font-size: 1.1em; opacity: 0.8; margin-bottom: 10px; }
.prize-card {
  background: rgba(255,255,255,0.08); backdrop-filter: blur(20px);
  border: 2px solid rgba(255,215,0,0.4); border-radius: 20px;
  padding: 25px; margin: 20px auto;
  animation: glowPulse 2s ease-in-out infinite;
}
@keyframes glowPulse { 0%,100% { box-shadow: 0 0 20px rgba(255,215,0,0.2); } 50% { box-shadow: 0 0 40px rgba(255,215,0,0.4); } }
.prize-card h3 { font-size: 1.4em; color: #ffd700; margin-bottom: 10px; }
.prize-card p { opacity: 0.8; line-height: 1.6; font-size: 0.95em; }
.prize-bouquet {
  display: flex; justify-content: center; gap: 3px; margin: 15px 0;
  flex-wrap: wrap;
}
.prize-bouquet span { font-size: 28px; animation: gentleSway 2s ease-in-out infinite; }
.prize-bouquet span:nth-child(2n) { animation-delay: 0.3s; }
.prize-bouquet span:nth-child(3n) { animation-delay: 0.6s; }
@keyframes gentleSway {
  0%,100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); }
}

/* Effects */
.heart-rain {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none; z-index: 999; overflow: hidden;
}
.rain-heart {
  position: absolute; top: -50px;
  animation: rainFall linear forwards; font-size: 30px;
}
@keyframes rainFall {
  0% { transform: translateY(-50px) rotate(0deg); opacity: 1; }
  100% { transform: translateY(110vh) rotate(720deg); opacity: 0.3; }
}
.sparkle {
  position: fixed; pointer-events: none; z-index: 1000;
  font-size: 16px; animation: sparkleFade 1s ease forwards;
}
@keyframes sparkleFade {
  0% { transform: scale(0) rotate(0deg); opacity: 1; }
  50% { transform: scale(1.5) rotate(180deg); opacity: 1; }
  100% { transform: scale(0) rotate(360deg); opacity: 0; }
}
.fade-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: #0a0015; z-index: 800; opacity: 0;
  pointer-events: none; transition: opacity 0.6s ease;
}
.fade-overlay.active { opacity: 1; pointer-events: all; }

@media (max-width: 500px) {
  .story-scene { font-size: 60px; }
  .story-text { font-size: 1.1em; padding: 20px; }
  .chapter-title { font-size: 1.6em; }
  .game-board { gap: 6px; max-width: 300px; }
  .card { font-size: 1.4em; border-radius: 10px; }
  .garden { gap: 6px; max-width: 320px; }
  .garden-spot { font-size: 1.8em; }
  .win-scene { font-size: 70px; }
  .win-text { font-size: 2em; }
}
</style>
</head>
<body>

<!-- Music toggle -->
<button id="musicBtn" onclick="toggleMusic()" style="
  position: fixed; top: 15px; right: 15px; z-index: 900;
  background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
  color: #fff; padding: 8px 14px; border-radius: 25px;
  font-size: 14px; cursor: pointer; backdrop-filter: blur(10px);
  transition: all 0.3s; display: flex; align-items: center; gap: 6px;
  font-family: 'Poppins', sans-serif;
">ğŸµ Play Music</button>
<div id="spotifyPlayer" style="
  position: fixed; top: 55px; right: 15px; z-index: 900;
  display: none; border-radius: 12px; overflow: hidden;
  box-shadow: 0 5px 30px rgba(0,0,0,0.6);
  transition: all 0.3s; background: rgba(0,0,0,0.8);
  backdrop-filter: blur(15px);
">
  <iframe id="spotifyFrame1" style="border-radius:12px 12px 0 0" src="" width="300" height="80" frameBorder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
  <iframe id="spotifyFrame2" style="border-radius:0 0 12px 12px" src="" width="300" height="80" frameBorder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
  <div style="padding:8px 10px; font-size:11px; opacity:0.5; text-align:center; font-family:'Poppins',sans-serif; color:#fff;">
    I Hate Models ğŸ–¤ Hit play, keep it going
  </div>
</div>

<div class="bg-hearts" id="bgHearts"></div>
<div class="fade-overlay" id="fadeOverlay"></div>

<div class="screen active" id="storyScreen">
  <div class="chapter-dots" id="chapterDots"></div>
  <div class="story-container">
    <div class="chapter-title" id="chTitle"></div>
    <div class="chapter-sub" id="chSub"></div>
    <div class="story-scene" id="storyScene"></div>
    <div class="story-narrator" id="storyNarrator"></div>
    <div class="story-text" id="storyText"></div>
    <button class="continue-btn" id="continueBtn">Continue</button>
  </div>
</div>

<div class="screen" id="game1">
  <div class="game-header"><h2>Break the Spell ğŸƒ</h2></div>
  <div class="game-stats">
    <span>ğŸ¾ <span id="moves">0</span> moves</span>
    <span>â­ <span id="pairs">0</span>/8</span>
  </div>
  <div class="game-board" id="gameBoard"></div>
</div>

<div class="screen" id="game2">
  <div class="game-header"><h2>Pick the Flowers ğŸŒ¸</h2></div>
  <div class="garden-container">
    <div class="garden-bouquet" id="bouquet"></div>
    <div class="garden-progress" id="gardenProg">Pick 12 flowers for Obi's freedom bouquet! ğŸ’</div>
    <div class="garden" id="garden"></div>
  </div>
</div>

<div class="screen" id="game3">
  <div class="game-header"><h2>The Final Lock ğŸ’Œ</h2></div>
  <div class="quiz-box">
    <div class="quiz-question" id="quizQ"></div>
    <div class="quiz-options" id="quizOpts"></div>
    <div class="quiz-progress" id="quizProg"></div>
  </div>
</div>

<div class="screen" id="win">
  <div class="win-content">
    <div class="win-scene">
      <span class="win-obi">ğŸˆâ€â¬›</span> <span>ğŸ’•</span> <span>ğŸ§¸</span>
    </div>
    <div class="win-text">I love you beb! ğŸ’•</div>
    <div class="win-sub">You saved Obi! He's free forever ğŸ¥¹</div>
    <div class="prize-bouquet" id="prizeBouquet"></div>
    <div class="prize-card">
      <h3>ğŸ€ Official Prize Certificate ğŸ€</h3>
      <p><strong>Obi the black cat</strong> is now yours forever! ğŸˆâ€â¬›</p>
      <p style="margin-top:8px;">Your bouquet of flowers, picked with love ğŸ’</p>
      <p style="margin-top:8px;">One teddy bear ğŸ§¸, unlimited hugs, and a boyfriend who promises to do better ğŸ’›</p>
      <p style="margin-top:12px; font-size:0.85em; opacity:0.5;">Redeemable immediately. No expiry date. Ever.</p>
    </div>
    <button class="continue-btn visible" style="margin-top:20px;" onclick="location.reload()">Play Again ğŸ’•</button>
  </div>
</div>

<div class="heart-rain" id="heartRain"></div>

<script>
// ==================== STORY ====================
const story = [
  {
    chapter: "Chapter 1", sub: "The Beginning",
    beats: [
      { scene: "ğŸŒ™", narrator: "Narrator", text: "Once upon a time, in a cozy little apartment filled with warm light and the smell of coffee, there lived a black cat named Obi." },
      { scene: "ğŸˆâ€â¬›", narrator: "Narrator", text: "Obi... short for Obsidian... had fur as dark as midnight, golden eyes like tiny suns, and a purr so deep it could make the whole couch vibrate." },
      { scene: "ğŸ’•", narrator: "Narrator", text: "He belonged to two people who loved each other very much. He'd curl up between them at night, one paw on each, like a little furry bridge connecting their hearts." },
      { scene: "â›ˆï¸", narrator: "Narrator", text: "But even the strongest love has storms. One evening, the air changed. Words that shouldn't have been said echoed through the rooms. Doors closed. Silence crept in like fog." },
      { scene: "ğŸˆâ€â¬›", narrator: "Obi", text: "\"I felt it before they did. The warmth between them... the thing I slept on every night... it was flickering. Like a candle in a draft.\"" },
      { scene: "ğŸŒƒ", narrator: "Narrator", text: "While his humans sat in separate rooms, Obi made a decision. He slipped through the cracked window, padded across the moonlit rooftop, and disappeared into the night." },
      { scene: "ğŸˆâ€â¬›", narrator: "Obi", text: "\"I had to find it. The warmth. If it wasn't inside anymore, maybe I could bring it back from outside. Cats always find what they're looking for... right?\"" },
      { scene: "ğŸŒ‘", narrator: "Narrator", text: "But the city at night is a different world. The streets twisted. The shadows grew longer. And somewhere in the darkest alley, something was waiting." },
      { scene: "ğŸ˜ˆ", narrator: "Heartbreak Monster", text: "\"Well, well... a little black cat, wandering alone. Looking for love? How... delicious. Let me show you what happens to love in MY world.\"" },
      { scene: "â›“ï¸", narrator: "Narrator", text: "Three chains erupted from the darkness. One wrapped around Obi's mind... confusion. One around his heart... coldness. One around his soul... doubt. Three locks clicked shut." },
      { scene: "ğŸˆâ€â¬›", narrator: "Obi", text: "\"I can't move... I can't think... everything is getting so cold. Please... if anyone can hear me... I went out there for love. Don't let it end like this.\"" },
      { btn: "I'll save you, Obi ğŸ¾" },
    ]
  },
  {
    chapter: "Chapter 2", sub: "The Confusion Spell",
    beats: [
      { scene: "ğŸŒ«ï¸", narrator: "Narrator", text: "The first chain was woven from confusion... every happy memory Obi ever had was scrambled, turned inside out, made unrecognizable." },
      { scene: "ğŸˆâ€â¬›", narrator: "Obi", text: "\"Everything is mixed up... I remember the sound of laughter but I can't remember whose. I remember the warmth but not where it came from. Please... put the pieces back together.\"" },
      { scene: "ğŸ§©", narrator: "Narrator", text: "Hidden in the chaos were matching pairs... fragments of the same memory, scattered like leaves in a storm. Find them all, and the spell breaks." },
      { game: 1, btn: "Break the confusion spell ğŸƒ" },
    ]
  },
  {
    chapter: "Chapter 2", sub: "Light in the Dark",
    beats: [
      { scene: "âœ¨", narrator: "Narrator", text: "CRACK! The first chain shattered like glass, each piece dissolving into golden sparks that danced upward and disappeared into the night sky." },
      { scene: "ğŸˆâ€â¬›", narrator: "Obi", text: "\"I remember now! I remember the lazy Sunday mornings, the head scratches, the sound of you two laughing at something stupid on TV. It's coming back!\"" },
      { scene: "ğŸ˜ˆ", narrator: "Heartbreak Monster", text: "\"One chain. Cute. But memories are easy. Let's see how you handle the next one...\"" },
      { scene: "ğŸ”’ğŸ”’", narrator: "Narrator", text: "Two chains remain. But something has changed... there's a faint glow around Obi now. The darkness noticed. And it's not happy." },
      { btn: "We keep going ğŸ’ª" },
    ]
  },
  {
    chapter: "Chapter 3", sub: "The Withered Garden",
    beats: [
      { scene: "ğŸ¥€", narrator: "Narrator", text: "The second chain was made of coldness... it had frozen Obi's heart, and with it, the garden of love that once bloomed inside him." },
      { scene: "ğŸšï¸", narrator: "Narrator", text: "Where there were once flowers of every color... memories of kisses, shared meals, inside jokes... now there was only frost and dead soil." },
      { scene: "ğŸˆâ€â¬›", narrator: "Obi", text: "\"My heart feels so cold... like winter moved in and forgot to leave. But I know the flowers are still there, under the frost. They just need someone to coax them out.\"" },
      { scene: "ğŸŒ±", narrator: "Narrator", text: "Pick the flowers as they bloom. Each one you gather adds warmth back to Obi's frozen heart. Collect a full bouquet to break the second chain." },
      { game: 2, btn: "Grow the garden back ğŸŒ¸" },
    ]
  },
  {
    chapter: "Chapter 3", sub: "Spring Returns",
    beats: [
      { scene: "ğŸŒ¸", narrator: "Narrator", text: "The second chain melted like ice in spring sunshine. Color rushed back into the world... pinks, golds, purples... flooding the darkness with warmth." },
      { scene: "ğŸˆâ€â¬›", narrator: "Obi", text: "\"I can feel again! My heart... it's beating so fast. Like when I was a kitten and discovered boxes for the first time. That kind of joy.\"" },
      { scene: "ğŸ’", narrator: "Narrator", text: "The flowers you picked swirled around Obi like a protective spell. Each petal carried a piece of love that the monster couldn't touch." },
      { scene: "ğŸ˜ˆ", narrator: "Heartbreak Monster", text: "\"...Fine. You want your cat? Then answer me this: do you even know what love IS? The final lock responds only to truth.\"" },
      { btn: "I know exactly what love is â¤ï¸" },
    ]
  },
  {
    chapter: "Chapter 4", sub: "The Truth Lock",
    beats: [
      { scene: "ğŸ”®", narrator: "Narrator", text: "The final chain was the strongest... forged from doubt itself. It whispered lies: you're not enough, love doesn't last, why even try." },
      { scene: "ğŸˆâ€â¬›", narrator: "Obi", text: "\"This is the one that almost got me. The voice that says love is just a word people throw around. But I know better. I've LIVED in love. I've slept in it every night.\"" },
      { scene: "ğŸ’Œ", narrator: "Narrator", text: "Five questions. Answer from your heart. The lock doesn't care about being smart... it cares about being real. Get four right, and the last chain falls forever." },
      { game: 3, btn: "Speak from the heart ğŸ’Œ" },
    ]
  },
  {
    chapter: "Chapter 5", sub: "Freedom",
    beats: [
      { scene: "ğŸ’¥", narrator: "Narrator", text: "The final chain didn't just break... it EXPLODED. A shockwave of pure light rippled outward, turning the dark alley into something that looked like sunrise." },
      { scene: "ğŸ˜ˆ", narrator: "Heartbreak Monster", text: "\"No... NO! This wasn't supposed to...  love breaks, love fades, love ENDS! That's the rule!\"" },
      { scene: "ğŸˆâ€â¬›", narrator: "Obi", text: "\"No. Love stumbles. Love gets scared. Love says stupid things at 2 AM. But love doesn't end... not when someone is willing to fight for it.\"" },
      { scene: "â˜€ï¸", narrator: "Narrator", text: "The Heartbreak Monster shrank. Smaller and smaller, until he was nothing but a tiny shadow, scrambling away from the light. He'd be back someday... monsters always come back. But today, love won." },
      { scene: "ğŸˆâ€â¬›", narrator: "Narrator", text: "Obi stretched his little legs, arched his back, and shook off the last traces of the chains. His fur was glossy again. His eyes were bright. And his purr... oh, his purr could be heard three blocks away." },
      { scene: "ğŸ ", narrator: "Narrator", text: "He padded home through streets that seemed warmer now, jumped through the window he'd left from, and curled up right in the middle of the couch." },
      { scene: "ğŸˆâ€â¬›", narrator: "Obi", text: "\"You know what I learned out there? Love isn't about being perfect. It's about showing up. Even when it's dark. Even when you're scared. Especially then.\"" },
      { scene: "ğŸ’•", narrator: "Obi", text: "\"And someone wanted me to tell you something. Something they maybe should say more often, but they mean it with every single heartbeat...\"" },
      { final: true },
    ]
  },
];

let currentChapter = 0, currentBeat = 0, isTyping = false, typeTimeout = null;
let pickedFlowers = [];

function initStory() { renderDots(); showBeat(); }

function renderDots() {
  const d = document.getElementById('chapterDots'); d.innerHTML = '';
  for (let i = 0; i < story.length; i++) {
    const dot = document.createElement('div');
    dot.className = 'ch-dot' + (i < currentChapter ? ' done' : '') + (i === currentChapter ? ' active' : '');
    d.appendChild(dot);
  }
}

function fade(cb) {
  const o = document.getElementById('fadeOverlay');
  o.classList.add('active');
  setTimeout(() => { cb(); setTimeout(() => o.classList.remove('active'), 100); }, 600);
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function showBeat() {
  const ch = story[currentChapter];
  if (!ch) return;
  const beat = ch.beats[currentBeat];
  if (!beat) return;

  document.getElementById('chTitle').textContent = ch.chapter;
  document.getElementById('chSub').textContent = ch.sub;
  renderDots();

  const btn = document.getElementById('continueBtn');
  btn.classList.remove('visible');

  if (beat.final) {
    fade(() => {
      showScreen('win');
      // Show picked flowers in prize
      const pb = document.getElementById('prizeBouquet');
      pb.innerHTML = '';
      pickedFlowers.forEach(f => {
        const s = document.createElement('span');
        s.textContent = f;
        pb.appendChild(s);
      });
      rainHearts();
    });
    return;
  }

  if (beat.game) {
    document.getElementById('storyScene').textContent = '';
    document.getElementById('storyNarrator').textContent = '';
    document.getElementById('storyText').innerHTML = '';
    btn.textContent = beat.btn;
    btn.classList.add('visible');
    btn.onclick = () => {
      fade(() => {
        showScreen('game' + beat.game);
        if (beat.game === 1) initMemory();
        if (beat.game === 2) initGarden();
        if (beat.game === 3) initQuiz();
      });
    };
    return;
  }

  if (beat.scene) document.getElementById('storyScene').textContent = beat.scene;
  document.getElementById('storyNarrator').textContent =
    beat.narrator === 'Narrator' ? 'ğŸ“– Narrator' :
    beat.narrator === 'Obi' ? 'ğŸˆâ€â¬› Obi' :
    'ğŸ˜ˆ ' + beat.narrator;

  if (beat.text) {
    typeText(beat.text, () => {
      btn.textContent = beat.btn || 'Continue âœ¨';
      btn.classList.add('visible');
      btn.onclick = () => nextBeat();
    });
  } else if (beat.btn) {
    document.getElementById('storyText').innerHTML = '';
    btn.textContent = beat.btn;
    btn.classList.add('visible');
    btn.onclick = () => nextBeat();
  }
}

function typeText(text, onDone) {
  const el = document.getElementById('storyText');
  el.innerHTML = '<span class="cursor"></span>';
  isTyping = true;
  let i = 0;
  function tick() {
    if (i < text.length) {
      el.innerHTML = text.substring(0, i + 1) + '<span class="cursor"></span>';
      i++;
      const ch = text[i-1];
      const delay = '.!?'.includes(ch) ? 80 : ch === ',' ? 50 : ch === '"' ? 30 : 22;
      typeTimeout = setTimeout(tick, delay);
    } else {
      isTyping = false; el.innerHTML = text;
      if (onDone) onDone();
    }
  }
  el.onclick = () => {
    if (isTyping) {
      clearTimeout(typeTimeout); isTyping = false;
      el.innerHTML = text; if (onDone) onDone();
    }
  };
  tick();
}

function nextBeat() {
  const ch = story[currentChapter];
  currentBeat++;
  if (currentBeat >= ch.beats.length) {
    currentChapter++; currentBeat = 0;
    if (currentChapter >= story.length) return;
    fade(() => showBeat());
  } else { showBeat(); }
}

function gameComplete() {
  fade(() => {
    showScreen('storyScreen');
    currentChapter++; currentBeat = 0;
    showBeat();
  });
}

// ==================== GAME 1: MEMORY ====================
const emojiSet = ['ğŸ’•','ğŸ’–','ğŸ’—','ğŸ’“','ğŸ’˜','ğŸ’','ğŸŒ¹','ğŸ’Œ'];
let memFlipped=[], memMatched=0, memMoves=0, memLocked=false;

function initMemory() {
  memMatched=0; memMoves=0; memFlipped=[]; memLocked=false;
  document.getElementById('moves').textContent='0';
  document.getElementById('pairs').textContent='0';
  const deck=[...emojiSet,...emojiSet];
  for(let i=deck.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[deck[i],deck[j]]=[deck[j],deck[i]];}
  const board=document.getElementById('gameBoard'); board.innerHTML='';
  deck.forEach(e => {
    const c=document.createElement('div'); c.className='card';
    c.innerHTML=`<span class="card-back">ğŸ¾</span><span class="card-front">${e}</span>`;
    c.dataset.emoji=e;
    c.addEventListener('click',()=>flipCard(c));
    board.appendChild(c);
  });
}

function flipCard(card) {
  if(memLocked||card.classList.contains('flipped')||card.classList.contains('matched'))return;
  if(memFlipped.length>=2)return;
  card.classList.add('flipped'); memFlipped.push(card);
  if(memFlipped.length===2){
    memMoves++; document.getElementById('moves').textContent=memMoves; memLocked=true;
    if(memFlipped[0].dataset.emoji===memFlipped[1].dataset.emoji){
      setTimeout(()=>{
        memFlipped[0].classList.add('matched'); memFlipped[1].classList.add('matched');
        memMatched++; document.getElementById('pairs').textContent=memMatched;
        memFlipped=[]; memLocked=false;
        if(memMatched===8) setTimeout(()=>gameComplete(),800);
      },500);
    } else {
      setTimeout(()=>{
        memFlipped[0].classList.remove('flipped'); memFlipped[1].classList.remove('flipped');
        memFlipped=[]; memLocked=false;
      },900);
    }
  }
}

// ==================== GAME 2: FLOWER GARDEN ====================
const flowers = ['ğŸŒ¸','ğŸŒº','ğŸŒ»','ğŸŒ¹','ğŸŒ·','ğŸ’®','ğŸŒ¼','ğŸµï¸','ğŸ’','ğŸª»','ğŸª·','ğŸŒ¾'];
const grassEmojis = ['ğŸŒ±','ğŸƒ','â˜˜ï¸'];
let gardenCount = 0;
let gardenSlots = [];
let gardenTimer = null;

function initGarden() {
  gardenCount = 0;
  pickedFlowers = [];
  document.getElementById('bouquet').innerHTML = '';
  document.getElementById('gardenProg').textContent = 'Pick 12 flowers for Obi\'s freedom bouquet! ğŸ’  (0/12)';
  const garden = document.getElementById('garden');
  garden.innerHTML = '';
  gardenSlots = [];

  // Create 20 spots (4 rows x 5)
  for (let i = 0; i < 20; i++) {
    const spot = document.createElement('div');
    spot.className = 'garden-spot empty';
    spot.textContent = grassEmojis[Math.floor(Math.random() * grassEmojis.length)];
    spot.dataset.index = i;
    garden.appendChild(spot);
    gardenSlots.push({ el: spot, hasFlower: false });
  }

  // Start blooming
  bloomRandom();
  gardenTimer = setInterval(bloomRandom, 1200);
}

function bloomRandom() {
  if (gardenCount >= 12) return;
  // Count current blooming flowers
  const blooming = gardenSlots.filter(s => s.hasFlower).length;
  if (blooming >= 5) return; // max 5 flowers at once

  // Find empty spots
  const empty = gardenSlots.filter(s => !s.hasFlower);
  if (empty.length === 0) return;

  // Bloom 1-2 flowers
  const count = Math.min(1 + Math.floor(Math.random() * 2), empty.length);
  for (let i = 0; i < count; i++) {
    const idx = Math.floor(Math.random() * empty.length);
    const slot = empty.splice(idx, 1)[0];
    const flower = flowers[Math.floor(Math.random() * flowers.length)];
    slot.hasFlower = true;
    slot.el.className = 'garden-spot blooming';
    slot.el.textContent = flower;
    slot.el.onclick = () => pickFlower(slot, flower);

    // Wilt after 4 seconds if not picked
    slot.wiltTimer = setTimeout(() => {
      if (slot.hasFlower) {
        slot.hasFlower = false;
        slot.el.className = 'garden-spot empty';
        slot.el.textContent = grassEmojis[Math.floor(Math.random() * grassEmojis.length)];
        slot.el.onclick = null;
      }
    }, 4000);
  }
}

function pickFlower(slot, flower) {
  if (!slot.hasFlower || gardenCount >= 12) return;
  slot.hasFlower = false;
  clearTimeout(slot.wiltTimer);

  // Sparkle burst
  for (let i = 0; i < 5; i++) {
    const sp = document.createElement('div');
    sp.className = 'sparkle-burst';
    sp.textContent = 'âœ¨';
    sp.style.setProperty('--tx', (Math.random()-0.5)*80+'px');
    sp.style.setProperty('--ty', (Math.random()-0.5)*80+'px');
    slot.el.appendChild(sp);
    setTimeout(() => sp.remove(), 600);
  }

  slot.el.className = 'garden-spot picked';
  setTimeout(() => {
    slot.el.className = 'garden-spot empty';
    slot.el.textContent = grassEmojis[Math.floor(Math.random() * grassEmojis.length)];
    slot.el.onclick = null;
  }, 400);

  // Add to bouquet
  gardenCount++;
  pickedFlowers.push(flower);
  const b = document.createElement('div');
  b.className = 'bouquet-flower';
  b.textContent = flower;
  document.getElementById('bouquet').appendChild(b);
  document.getElementById('gardenProg').textContent = `Pick 12 flowers for Obi's freedom bouquet! ğŸ’  (${gardenCount}/12)`;

  if (gardenCount >= 12) {
    clearInterval(gardenTimer);
    // Clear remaining flowers
    gardenSlots.forEach(s => {
      if (s.hasFlower) {
        s.hasFlower = false;
        s.el.className = 'garden-spot empty';
        s.el.textContent = 'âœ¨';
      }
    });
    document.getElementById('gardenProg').textContent = 'ğŸ’ Beautiful bouquet complete! ğŸ’';
    setTimeout(() => gameComplete(), 1200);
  }
}

// ==================== GAME 3: QUIZ ====================
const quizData = [
  { q: "What's the best way to say sorry?", opts: ["Text 'my bad' ğŸ’€","Buy flowers and say it in person ğŸ’","Blame the dog ğŸ•","Build her a whole website ğŸ”¥"], correct: 3 },
  { q: "When she says 'I'm fine', she means...", opts: ["She's totally fine âœ…","She is NOT fine, go fix it NOW ğŸš¨","Time to play video games ğŸ®","Ask again in 3 hours â°"], correct: 1 },
  { q: "The best gift for your girl is...", opts: ["Gift card ğŸ’³","Your time and attention ğŸ’•","A meme ğŸ˜‚","Literally anything from Shein ğŸ“¦"], correct: 1 },
  { q: "How do you win an argument?", opts: ["Raise your voice louder ğŸ“¢","Present a PowerPoint ğŸ“Š","You don't... you hug her ğŸ¤—","Google 'how to win argument with gf'"], correct: 2 },
  { q: "What makes a relationship last?", opts: ["Being right all the time ğŸ†","Trust, patience & effort ğŸ’›","Matching outfits ğŸ‘«","Having the Wi-Fi password ğŸ“¶"], correct: 1 },
  { q: "What would Obi say about love?", opts: ["Meow ğŸ±","Love is warm like a sunspot ğŸŒ","Knock things off tables as a love language ğŸ˜¼","All of the above ğŸˆâ€â¬›"], correct: 3 },
];
let quizIdx=0, quizScore=0;

function initQuiz() { quizIdx=0; quizScore=0; showQ(); }

function showQ() {
  if(quizIdx>=quizData.length) {
    if(quizScore>=4) setTimeout(()=>gameComplete(),500);
    else { quizIdx=0; quizScore=0; showQ(); }
    return;
  }
  const q=quizData[quizIdx];
  document.getElementById('quizQ').textContent=q.q;
  document.getElementById('quizProg').textContent=`${quizIdx+1}/${quizData.length} â€¢ Score: ${quizScore} ğŸˆâ€â¬›`;
  const opts=document.getElementById('quizOpts'); opts.innerHTML='';
  q.opts.forEach((o,i) => {
    const btn=document.createElement('button'); btn.className='quiz-opt'; btn.textContent=o;
    btn.onclick=()=>{
      document.querySelectorAll('.quiz-opt').forEach((b,j)=>{
        b.style.pointerEvents='none';
        if(j===q.correct) b.classList.add('correct');
        if(j===i&&i!==q.correct) b.classList.add('wrong');
      });
      if(i===q.correct) quizScore++;
      setTimeout(()=>{quizIdx++;showQ();},1200);
    };
    opts.appendChild(btn);
  });
}

// ==================== EFFECTS ====================
function rainHearts() {
  const c=document.getElementById('heartRain'); c.innerHTML='';
  const h=['ğŸ’•','ğŸ’–','ğŸ’—','ğŸ’“','ğŸ’','ğŸ’˜','â¤ï¸','ğŸŒ¹','âœ¨','ğŸˆâ€â¬›','ğŸ¾','ğŸŒ¸','ğŸŒº'];
  for(let i=0;i<70;i++){
    setTimeout(()=>{
      const d=document.createElement('div'); d.className='rain-heart';
      d.textContent=h[Math.floor(Math.random()*h.length)];
      d.style.left=Math.random()*100+'%';
      d.style.fontSize=(20+Math.random()*30)+'px';
      d.style.animationDuration=(2+Math.random()*3)+'s';
      c.appendChild(d); setTimeout(()=>d.remove(),5000);
    },i*70);
  }
}

(function(){
  const c=document.getElementById('bgHearts');
  const h=['ğŸ’•','ğŸ’–','ğŸ¾','âœ¨','ğŸŒ¸','ğŸŒ¹'];
  for(let i=0;i<20;i++){
    const d=document.createElement('div'); d.className='bg-heart';
    d.textContent=h[Math.floor(Math.random()*h.length)];
    d.style.left=Math.random()*100+'%';
    d.style.fontSize=(14+Math.random()*18)+'px';
    d.style.animationDuration=(8+Math.random()*12)+'s';
    d.style.animationDelay=Math.random()*10+'s';
    c.appendChild(d);
  }
})();

document.addEventListener('click',e=>{
  const sp=['âœ¨','ğŸ’–','ğŸ¾','ğŸ’•'];
  for(let i=0;i<3;i++){
    const s=document.createElement('div'); s.className='sparkle';
    s.textContent=sp[Math.floor(Math.random()*sp.length)];
    s.style.left=(e.clientX+(Math.random()-0.5)*60)+'px';
    s.style.top=(e.clientY+(Math.random()-0.5)*60)+'px';
    document.body.appendChild(s); setTimeout(()=>s.remove(),1000);
  }
});

// Music - Spotify with I Hate Models tracks
let musicOpen = false;
function toggleMusic() {
  const btn = document.getElementById('musicBtn');
  const player = document.getElementById('spotifyPlayer');
  const frame = document.getElementById('spotifyFrame');

  if (musicOpen) {
    player.style.display = 'none';
    document.getElementById('spotifyFrame1').src = '';
    document.getElementById('spotifyFrame2').src = '';
    btn.innerHTML = 'ğŸµ Play Music';
    musicOpen = false;
  } else {
    document.getElementById('spotifyFrame1').src = 'https://open.spotify.com/embed/track/6ZWYsvOTYigBYoHMpFOyoA?utm_source=generator&theme=0';
    document.getElementById('spotifyFrame2').src = 'https://open.spotify.com/embed/track/0eRbOJ7nguOh6UCV1Lbpwn?utm_source=generator&theme=0';
    player.style.display = 'block';
    btn.innerHTML = 'âœ• Hide';
    musicOpen = true;
  }
}

initStory();
</script>
</body>
</html>
